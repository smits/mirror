var Grabber=function(){"use strict";var e=document.querySelector("video"),t=document.querySelector("header"),n=document.createElement("h3");t.removeChild(document.querySelector("noscript"));navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;window.URL=window.URL||window.webkitURL;if(!navigator.getUserMedia||!window.URL){var r="";r+="Ouch! No love for WebRTC here<br />";r+='Try <a href="http://www.google.com/chrome/" target="_blank">Google Chrome</a> ';r+='or <a href="http://www.mozilla.org/firefox/" target="_blank">Firefox</a>';n.innerHTML=r;t.appendChild(n);return}var i=function(r){setTimeout(function(){t.removeChild(n)},500);n.className+=" fade-out";e.src=window.URL.createObjectURL(r);Subtraction.init();DOM.init()},s=function(e){};navigator.getUserMedia({audio:!1,video:!0},i,s);n.setAttribute("class","icon icon-up");n.innerHTML="Give me some sugar &<br />allow camera access";t.appendChild(n);return{getVideo:function(){return e}}}(),Subtraction=function(){"use strict";var e=document.querySelector("canvas"),t=e.getContext("2d"),n=160,r=120,i=30,s=0,o=Math.abs,u=n*r,a,f,l,c,h=function(){e.width=n;e.height=r;setTimeout(p,1500)},p=function(){rAF(p);t.save();t.scale(-1,1);t.drawImage(Grabber.getVideo(),-n,0,n,r);t.restore();a=t.getImageData(0,0,n,r);f=d(a);t.putImageData(f,0,0);s%10===0&&(l=f);s++;if(!l)return;c=v(a,f,l);g(c,8)},d=function(e){var i=t.createImageData(n,r),s=i.data,o=e.data,a=u;while(--a){var f=4*a,l=f+1,c=f+2,h=f+3,p=.34*o[f]+.5*o[l]+.16*o[c];s[f]=p;s[l]=p;s[c]=p;s[h]=255}return i},v=function(e,s,a){var f=t.createImageData(n,r),l=s.data,c=e.data,h=a.data,p=f.data,d=u;while(--d){var v=4*d,m=v+1,g=v+2,y=v+3;p[v]=o(l[v]-h[v])<i?0:c[v];p[m]=o(l[m]-h[m])<i?0:c[m];p[g]=o(l[g]-h[g])<i?0:c[g];p[y]=255}return f},m=function(e,t,n){var r=t*4+n*4*e.width,i=e.data,s,o,u,a;s=i[r];o=i[r+1];u=i[r+2];a=i[r+3];s+=s*.5>>0;u+=u*.25>>0;a===0&&(a=255);return"rgba("+s+","+o+","+u+","+a+")"},g=function(e,t){var i=0;for(var s=0;s<r;s+=t)for(var o=0;o<n;o+=t){var u=m(e,o,s);DOM.update(i,u);i++}};return{init:h}}(),DOM=function(){"use strict";var e=document.querySelector("#mirror"),t=document.querySelector("canvas"),n,r,i=function(){var i="",s=0;for(var o=0;o<20;o++)for(var u=0;u<15;u++){i+='<div id="'+s++ +'" class="pixel">';i+='<div class="inner">';i+='<div class="front"></div>';i+='<div class="back"></div>';i+="</div>";i+="</div>"}e.innerHTML+=i;n=document.getElementsByClassName("pixel");r=document.getElementsByClassName("back");setTimeout(function(){e.setAttribute("class","fade-in")},750);setTimeout(function(){t.setAttribute("class","fade-in")},1750)},s=function(e,t){var i=n[e].classList;if(i.contains("hover"))return;if(t!=="rgba(0,0,0,255)"){r[e].style.backgroundColor=t;i.add("hover");e%12===2&&Sound.generator();clearTimeout(r[e].timer);r[e].timer=setTimeout(function(){i.remove("hover")},500)}};return{init:i,update:s}}(),Sound=function(){"use strict";window.AudioContext=window.AudioContext||window.webkitAudioContext;var e=window.AudioContext?new AudioContext:!1,t=function(){if(!e)return;var t=e.createOscillator(),n=e.createGain();n.gain.linearRampToValueAtTime(0,e.currentTime);n.gain.linearRampToValueAtTime(.6,e.currentTime+.01);n.gain.linearRampToValueAtTime(0,e.currentTime+.01+Math.random()*2.9);n.connect(e.destination);t.frequency.value=220*(1+Math.floor(Math.random()*10))>>0;t.connect(n);t.type=0;setTimeout(function(){t.noteOff(0)},3e3);t.noteOn(0)};return{generator:t}}(),rAF=function(){"use strict";var e=["ms","o","moz","webkit",""],t=e.length,n=0,r;while(t--&&!r)r=window[e[t]+"requestAnimationFrame"];r=r||function(e){var t=+(new Date),r=Math.max(0,16-(t-n)),i=setTimeout(function(){e(t+r)},r);n=t+r;return i};return r}();